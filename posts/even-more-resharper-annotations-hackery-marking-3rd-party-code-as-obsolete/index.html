<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Even more ReSharper Annotations hackery: marking 3rd party code as obsolete | In Absentia</title>
  <meta name="description" content="by Igal Tabachnik">
  <meta name="keywords" content="programming, software, scala, haskell, functional programming">

  <meta property="og:type" content="website">
  <meta property="og:title" content="Even more ReSharper Annotations hackery: marking 3rd party code as obsolete">
  <meta property="og:description" content="by Igal Tabachnik">
  <meta property="og:url" content="https:&#x2F;&#x2F;hmemcpy.com&#x2F;posts&#x2F;even-more-resharper-annotations-hackery-marking-3rd-party-code-as-obsolete&#x2F;">
  
    <meta property="og:site_name" content="In Absentia">
  
  

  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@hmemcpy">
  

  
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="https://hmemcpy.com/atom.xml">
  

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&family=Lora:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="stylesheet" href="https://hmemcpy.com/linen.css?h=7516597de5795edf0603">
</head>

<body>
  <div class="headband"></div>

  <header class="site-header">
    <div class="header-inner">
      <a href="https:&#x2F;&#x2F;hmemcpy.com" class="site-brand">
        <span class="site-title">In Absentia</span>
      </a>

      <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
      </button>

      
        <nav class="site-nav">
          <ul class="nav-menu">
            
              <li class="nav-item">
                <a href="&#x2F;">Home</a>
              </li>
            
              <li class="nav-item">
                <a href="&#x2F;posts&#x2F;">Archives</a>
              </li>
            
              <li class="nav-item">
                <a href="&#x2F;talks-i-liked&#x2F;">Talks I liked</a>
              </li>
            
              <li class="nav-item">
                <a href="&#x2F;cv.pdf">CV</a>
              </li>
            
          </ul>
        </nav>
      

      <div class="header-search" id="header-search">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input
          type="search"
          id="search-input"
          class="search-input"
          placeholder="Search…"
          autocomplete="off"
          aria-label="Search posts"
        >
        <ul class="search-results" id="search-results" hidden></ul>
      </div>
    </div>
  </header>

  <main class="main">
    <div class="main-inner">
      
<article class="post-block">
  <header class="post-header">
    <h1 class="post-title">Even more ReSharper Annotations hackery: marking 3rd party code as obsolete</h1>
    
    <div class="post-meta">
      <span class="post-meta-item">
        <span class="post-meta-item-icon"><i class="far fa-calendar"></i></span>
        <time datetime="2013-03-24T23:16:14Z">2013-03-24</time>
      </span>

      

      
        <span class="post-meta-item">
          <span class="post-meta-item-icon"><i class="far fa-clock"></i></span>
          3 min read
        </span>
      

      
        <a class="edit-link" href="https:&#x2F;&#x2F;github.com&#x2F;hmemcpy&#x2F;hmemcpy.com/edit/main/content/posts&#x2F;even-more-resharper-annotations-hackery-marking-3rd-party-code-as-obsolete.md" target="_blank" rel="noopener" title="Edit on GitHub">
          <i class="fa-solid fa-pencil"></i>
        </a>
      

      
    </div>
    
  </header>

  <div class="post-body">
    <p>As part of transitioning to a new API, I wanted a way to mark the old API as obsolete, so that Visual Studio (or ReSharper) would flag using of the old API as an error.</p>
<span id="continue-reading"></span>
<p>Normally, the <a rel="external" href="http://msdn.microsoft.com/en-us/library/system.obsoleteattribute.aspx"><code>ObsoleteAttribute</code></a> does exactly that - marks certain methods or types as obsolete, and has a constructor overload to specify whether the usage will be treated as an error or not. Unfortunately, in my case there was no source code for the old API (it was used as a 3<sup>rd</sup>-party DLL), and there's no way to apply the Obsolete attribute to external DLLs without modifying the assembly using IL-rewriting tools.</p>
<p>It had occurred to me that perhaps this would be possible to achieve using one of <a rel="external" href="http://www.jetbrains.com/resharper/webhelp/Code_Analysis__External_Annotations.html">ReSharper's External Annotations</a>, but there are no built-in annotations for this kind of task. The annotations mechanism is used to decorate various .NET types and methods with special attributes that provide ReSharper with additional information. Turns out, it is possible to use the same mechanism to apply the Obsolete attribute as well! This way, ReSharper could mark the usage as an error, even if it's not really a compilation error (which is good enough for me!).</p>
<p>I <a href="/posts/preventing-resharpers-implicitly-captured-closure-warning-in-fakeiteasy-unit-tests/">previously wrote</a> about how to add external annotations using XML files. According to ReSharper's documentation, external annotation XMLs can be placed in one of the following locations:</p>
<ul>
<li><code>[ReSharper install directory]\Bin\ExternalAnnotations\[Assembly name].xml</code></li>
<li><code>[ReSharper install directory]\Bin\ExternalAnnotations\[Assembly name]\[Any name].xml</code>, where <code>[Assembly name]</code> is the assembly name without the version</li>
<li>Alongside the assembly, named <code>[Assembly name].ExternalAnnotations.xml</code></li>
</ul>
<p>Since the old assembly was under my control, I chose the 3<sup>rd</sup> option, to place the annotations XML next to the assembly, and in the source control. This way, every team member that uses ReSharper will have this annotation enabled by simply updating to the latest source.</p>
<p>The external annotations XMLs are the same format as <a rel="external" href="http://msdn.microsoft.com/en-us/library/fsbx0t7x.aspx">XML documentation</a> files, generated by Visual Studio when you build your assembly. Supposing our assembly name is <strong><code>Acme.OldServiceBusImpl.dll</code></strong>, and the type we want to make obsolete is called <strong><code>EventBus</code></strong>, we need to create a file called <strong><code>Acme.OldServiceBusImpl.ExternalAnnotations.xml</code></strong>, and place it beside the DLL. The file has the following content:</p>
<pre class="giallo" style="color: #D8DEE9; background-color: #2E3440;"><code data-lang="xml"><span class="giallo-l"><span style="color: #81A1C1;">&lt;assembly</span><span style="color: #8FBCBB;"> name</span><span>=</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #A3BE8C;">Acme.OldEventBusImpl</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #81A1C1;">&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">  &lt;member</span><span style="color: #8FBCBB;"> name</span><span>=</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #A3BE8C;">T:Acme.OldEventBusImpl.EventBus</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #81A1C1;">&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">    &lt;attribute</span><span style="color: #8FBCBB;"> ctor</span><span>=</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #A3BE8C;">M:System.ObsoleteAttribute.#ctor(System.String,System.Boolean)</span><span style="color: #ECEFF4;">&quot;</span><span style="color: #81A1C1;">&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">      &lt;argument&gt;</span><span>Use Acme.NewServiceBusImpl.ServiceBus instead.</span><span style="color: #81A1C1;">&lt;/argument&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">      &lt;argument&gt;</span><span>true</span><span style="color: #81A1C1;">&lt;/argument&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">    &lt;/attribute&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">  &lt;/member&gt;</span></span>
<span class="giallo-l"><span style="color: #81A1C1;">&lt;/assembly&gt;</span></span></code></pre>
<p>This specifies that for an assembly named <code>Acme.OldServiceBusImpl</code>, having a type <code>Acme.OldEventBusImpl.EventBus</code>, add an attribute instance of <code>ObsoleteAttribute</code> with the constructor overload <a rel="external" href="http://msdn.microsoft.com/en-us/library/961hff5d.aspx"><code>ObsoleteAttribute(string, bool)</code></a>, the boolean indicating the usage is considered an error.</p>
<p>After adding the XML file and reloading your project, ReSharper will now mark the usage of this type as an error! Your code will still compile, but <a rel="external" href="http://www.youtube.com/watch?v=j-n_yxJqYi0">you'll get red on you</a>!</p>
<img title="" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="" src="http://i1.wp.com/hmemcpy.com/wp-content/uploads/2013/03/image6.png?resize=624%2C69" data-recalc-dims="1" />
<p>Happy hacking!</p>

  </div>

  
  <footer class="post-footer">
    

    
<div class="post-nav">
  
    <div class="post-nav-item post-nav-next">
      <a href="https:&#x2F;&#x2F;hmemcpy.com&#x2F;posts&#x2F;more-fun-with-resharper-annotations-in-asp-net-mvc&#x2F;" rel="next" title="More fun with ReSharper annotations in ASP.NET MVC!">
        <i class="fa fa-angle-left"></i> <span class="nav-title">More fun with ReSharper annotations in ASP.NET MVC!</span>
      </a>
    </div>
  
  
    <div class="post-nav-item post-nav-prev">
      <a href="https:&#x2F;&#x2F;hmemcpy.com&#x2F;posts&#x2F;first-rule-of-unit-testing-dont-do-it-yet&#x2F;" rel="prev" title="First Rule of Unit Testing: Don&#x27;t do it! (yet)">
        <span class="nav-title">First Rule of Unit Testing: Don&#x27;t do it! (yet)</span> <i class="fa fa-angle-right"></i>
      </a>
    </div>
  
</div>

  </footer>
  
</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-inner">
      
        <div class="footer-social">
          
            <a href="https:&#x2F;&#x2F;github.com&#x2F;hmemcpy" title="GitHub" target="_blank" rel="noopener">
              <i class="fab fa-github"></i>
            </a>
          
            <a href="https:&#x2F;&#x2F;x.com&#x2F;hmemcpy" title="X" target="_blank" rel="noopener">
              <i class="fab fa-x-twitter"></i>
            </a>
          
            <a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;8205&#x2F;igal-tabachnik" title="Stack Overflow" target="_blank" rel="noopener">
              <i class="fab fa-stack-overflow"></i>
            </a>
          
            <a href="https:&#x2F;&#x2F;il.linkedin.com&#x2F;in&#x2F;igaltabachnik" title="LinkedIn" target="_blank" rel="noopener">
              <i class="fab fa-linkedin"></i>
            </a>
          
        </div>
      
      <div class="footer-copyright">
        &copy;
        2009 &ndash; 
        2026
        <span class="author">Igal Tabachnik</span>
      </div>
    </div>
  </footer>

  <script>
    // Nav hamburger
    var navToggle = document.querySelector('.nav-toggle');
    if (navToggle) {
      navToggle.addEventListener('click', function() {
        var nav = document.querySelector('.site-nav');
        var open = nav.classList.toggle('open');
        this.setAttribute('aria-expanded', open);
      });
    }

    // Search — uses Pagefind JS API directly
    (async function() {
      var input   = document.getElementById('search-input');
      var results = document.getElementById('search-results');
      var pagefind;

      try {
        pagefind = await import('/pagefind/pagefind.js');
        await pagefind.options({ excerptLength: 12 });
      } catch(e) {
        return; // Pagefind not built yet (local dev) — fail silently
      }

      async function runSearch(query) {
        if (!query) { results.hidden = true; return; }
        var res = await pagefind.search(query);
        var hits = await Promise.all(res.results.slice(0, 8).map(function(r) { return r.data(); }));
        if (!hits.length) { results.hidden = true; return; }
        results.innerHTML = hits.map(function(hit) {
          return '<li class="search-result"><a href="' + hit.url + '">'
            + '<span class="result-title">' + (hit.meta && hit.meta.title ? hit.meta.title : hit.url) + '</span>'
            + '<span class="result-excerpt">' + hit.excerpt + '</span>'
            + '</a></li>';
        }).join('');
        results.hidden = false;
      }

      input.addEventListener('input', function() { runSearch(this.value.trim()); });

      document.addEventListener('click', function(e) {
        if (!document.getElementById('header-search').contains(e.target)) {
          results.hidden = true;
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') { results.hidden = true; input.blur(); }
        if (e.key === '/' && document.activeElement !== input
            && document.activeElement.tagName !== 'INPUT'
            && document.activeElement.tagName !== 'TEXTAREA') {
          e.preventDefault();
          input.focus();
        }
      });
    })();
  </script>
</body>
</html>
